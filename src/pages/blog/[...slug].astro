---
import { Image } from 'astro:assets'
import FormattedDate from '@/components/FormattedDate.astro'
import Prose from '@/components/Prose.astro'
import Layout from '@/layouts/Layout.astro'

import { getCollection } from 'astro:content'
export async function getStaticPaths() {
  const blogEntries = await getCollection('blog')
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { Content } = await entry.render()

const wordCount = entry.body?.split(/\s+/).length ?? 0
const readingTime = Math.max(1, Math.ceil(wordCount / 250))
---

<Layout
  title={entry.data.title}
  description="Blog Post for stevegreco.dev"
  image={`/blog/${entry.slug}.png`}
>
  <article class="max-w-prose mx-auto px-4 py-8 md:py-16">
    <a
      href="/blog"
      class="text-sm font-mono text-muted-foreground hover:text-primary transition-colors"
    >
      &larr; back to writing
    </a>

    <header class="mt-6 mb-10">
      <div class="flex items-center gap-3 text-xs font-mono text-muted-foreground mb-3">
        <FormattedDate date={entry.data.date} />
        <span>&middot;</span>
        <span>{readingTime} min read</span>
        {entry.data.tags && entry.data.tags.length > 0 && (
          <>
            <span>&middot;</span>
            <span>{entry.data.tags.join(', ')}</span>
          </>
        )}
      </div>
      <h1 class="text-3xl md:text-5xl font-bold tracking-tight leading-tight">
        {entry.data.title}
      </h1>
    </header>

    {entry.data.image && (
      <Image
        class="w-full rounded-lg mb-10 object-cover"
        src={entry.data.image}
        alt={entry.data.title}
      />
    )}

    <Prose>
      <Content />
    </Prose>
  </article>
</Layout>
