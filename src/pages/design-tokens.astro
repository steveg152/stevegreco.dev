---
import Layout from '@/layouts/Layout.astro'
import '@/styles/design-tokens-page.css'
import primitivesCss from '@/styles/tokens/primitives.css?raw'

interface TokenEntry {
  name: string
  value: string
}

const tokenPattern = /--([a-z0-9-]+):\s*([^;]+);/g
const tokens: TokenEntry[] = []

for (const match of primitivesCss.matchAll(tokenPattern)) {
  const [, name, value] = match
  tokens.push({ name, value: value.trim() })
}

const colorTokens = tokens.filter((t) => t.name.startsWith('color-'))
const anchors = colorTokens.filter((t) =>
  ['color-white', 'color-black'].includes(t.name)
)

const stops = ['50', '100', '200', '300', '400', '500', '600', '700', '800', '900', '950']

const paletteMap = new Map<string, { token: TokenEntry; stop: string }[]>()
for (const token of colorTokens) {
  if (token.name === 'color-white' || token.name === 'color-black') continue
  const m = token.name.match(/^color-([a-z-]+)-(\d{2,3})$/)
  if (!m) continue
  const [, palette, stop] = m
  if (!paletteMap.has(palette)) paletteMap.set(palette, [])
  paletteMap.get(palette)!.push({ token, stop })
}

const label = (s: string) =>
  s
    .split('-')
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(' ')

const palettes = Array.from(paletteMap.entries()).map(([name, entries]) => ({
  name,
  label: label(name),
  stops: entries,
}))

const spacingTokens = tokens.filter((t) => t.name.startsWith('space-'))
const fontSizeTokens = tokens.filter((t) => t.name.startsWith('text-'))
const fontFamilyTokens = tokens.filter((t) => t.name.startsWith('font-'))
const fontWeightTokens = tokens.filter((t) => t.name.startsWith('weight-'))
const leadingTokens = tokens.filter((t) => t.name.startsWith('leading-'))
const trackingTokens = tokens.filter((t) => t.name.startsWith('tracking-'))
const radiusTokens = tokens.filter((t) => t.name.startsWith('radius-'))
const shadowTokens = tokens.filter((t) => t.name.startsWith('shadow-'))
const borderTokens = tokens.filter((t) => t.name.startsWith('border-'))
---

<Layout
  title="Design Tokens - Steve Greco"
  description="Primitive design token reference for colors, spacing, typography, radius, shadows, and borders."
>
  <div class="dt-page">
    <header class="dt-header">
      <h1>Design Tokens</h1>
      <p>
        Tier 1 primitive reference sourced from
        <code>primitives.css</code>.
        Hidden from navigation â€” for design-system use only.
      </p>
    </header>

    <!-- Colors -->
    <section class="dt-section">
      <h2>Colors</h2>

      <div class="dt-anchors">
        {anchors.map((t) => (
          <div class="dt-anchor">
            <span class="dt-anchor-swatch" style={`background-color: ${t.value}`} />
            <div>
              <p class="dt-token-name">{`--${t.name}`}</p>
              <p class="dt-token-value">{t.value}</p>
            </div>
          </div>
        ))}
      </div>

      <div class="dt-palettes">
        {palettes.map((palette) => (
          <div class="dt-palette">
            <h3>{palette.label}</h3>
            <div class="dt-palette-row">
              {palette.stops.map(({ token, stop }) => (
                <div class="dt-palette-cell">
                  <span class="dt-swatch" style={`background-color: ${token.value}`} />
                  <p class="dt-stop-label">{stop}</p>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- Spacing -->
    <section class="dt-section">
      <h2>Spacing</h2>
      <div class="dt-table">
        {spacingTokens.map((t) => (
          <div class="dt-table-row">
            <span class="dt-token-name dt-col-name">{`--${t.name}`}</span>
            <span class="dt-token-value dt-col-value">{t.value}</span>
            <div class="dt-col-preview">
              <span class="dt-spacing-bar" style={`width: ${t.value === '0' ? '0px' : t.value}`} />
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- Font Size -->
    <section class="dt-section">
      <h2>Font Size</h2>
      <div class="dt-table">
        {fontSizeTokens.map((t) => (
          <div class="dt-table-row">
            <span class="dt-token-name dt-col-name">{`--${t.name}`}</span>
            <span class="dt-token-value dt-col-value">{t.value}</span>
            <p class="dt-col-preview" style={`font-size: ${t.value}`}>
              The quick brown fox
            </p>
          </div>
        ))}
      </div>
    </section>

    <!-- Font Family -->
    <section class="dt-section">
      <h2>Font Family</h2>
      <div class="dt-table">
        {fontFamilyTokens.map((t) => (
          <div class="dt-table-row">
            <span class="dt-token-name dt-col-name">{`--${t.name}`}</span>
            <p class="dt-col-preview" style={`font-family: ${t.value}; font-size: 1.125rem`}>
              The quick brown fox jumps over the lazy dog
            </p>
          </div>
        ))}
      </div>
    </section>

    <!-- Font Weight -->
    <section class="dt-section">
      <h2>Font Weight</h2>
      <div class="dt-table">
        {fontWeightTokens.map((t) => (
          <div class="dt-table-row">
            <span class="dt-token-name dt-col-name">{`--${t.name}`}</span>
            <span class="dt-token-value dt-col-value">{t.value}</span>
            <p class="dt-col-preview" style={`font-weight: ${t.value}; font-size: 1.125rem`}>
              The quick brown fox
            </p>
          </div>
        ))}
      </div>
    </section>

    <!-- Line Height -->
    <section class="dt-section">
      <h2>Line Height</h2>
      <div class="dt-table">
        {leadingTokens.map((t) => (
          <div class="dt-table-row dt-table-row--top">
            <span class="dt-token-name dt-col-name">{`--${t.name}`}</span>
            <span class="dt-token-value dt-col-value">{t.value}</span>
            <p class="dt-col-preview dt-leading-sample" style={`line-height: ${t.value}`}>
              Design tokens are the atoms of a design system. They store decisions, not implementations.
            </p>
          </div>
        ))}
      </div>
    </section>

    <!-- Letter Spacing -->
    <section class="dt-section">
      <h2>Letter Spacing</h2>
      <div class="dt-table">
        {trackingTokens.map((t) => (
          <div class="dt-table-row">
            <span class="dt-token-name dt-col-name">{`--${t.name}`}</span>
            <span class="dt-token-value dt-col-value">{t.value}</span>
            <p class="dt-col-preview" style={`letter-spacing: ${t.value}; font-size: 1.125rem; text-transform: uppercase`}>
              Design Tokens
            </p>
          </div>
        ))}
      </div>
    </section>

    <!-- Border Radius -->
    <section class="dt-section">
      <h2>Border Radius</h2>
      <div class="dt-visual-row">
        {radiusTokens.map((t) => (
          <div class="dt-visual-item">
            <span class="dt-radius-box" style={`border-radius: ${t.value}`} />
            <p class="dt-token-name">{`--${t.name}`}</p>
            <p class="dt-token-value">{t.value}</p>
          </div>
        ))}
      </div>
    </section>

    <!-- Shadows -->
    <section class="dt-section">
      <h2>Shadows</h2>
      <div class="dt-shadow-surface">
        {shadowTokens.map((t) => (
          <div class="dt-visual-item">
            <span class="dt-shadow-box" style={`box-shadow: ${t.value}`} />
            <p class="dt-token-name">{`--${t.name}`}</p>
          </div>
        ))}
      </div>
    </section>

    <!-- Border Width -->
    <section class="dt-section">
      <h2>Border Width</h2>
      <div class="dt-visual-row">
        {borderTokens.map((t) => (
          <div class="dt-visual-item">
            <span class="dt-border-box" style={`border-width: ${t.value}`} />
            <p class="dt-token-name">{`--${t.name}`}</p>
            <p class="dt-token-value">{t.value}</p>
          </div>
        ))}
      </div>
    </section>
  </div>
</Layout>
